# import base64
# #
# # font_face = "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"
# # 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
# font_face = "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"
# print(len(font_face))
# #
# b = base64.b64decode(font_face)
# with open('new_font.ttf','wb') as f:
#     f.write(b)

#
# from fontTools.ttLib import TTFont
#
# font = TTFont('new_font.ttf')
# font.saveXML('02.xml')


from fontTools.ttLib import TTFont
import requests
import chardet
import re
import base64
from scrapy import Selector

url = 'http://piaofang.maoyan.com/?ver=normal&isid_key=1A5BCB853F44B09D6DC5DC4D74A89B17C7434B37F87C5DB9F89B3FB776FCC134'
headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.119 Safari/537.36',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
}
response = requests.get(url=url, headers=headers).content  # 得到字节
charset = chardet.detect(response).get('encoding')  # 得到编码格式
response = response.decode(charset, "ignore")  # 解码得到字符串
# print(response)
# 本地已经下载好的字体处理
base_font = TTFont('font.ttf')  # 打开本地的ttf文件

base_uni_list = base_font.getGlyphOrder()[2:]  # 获取所有编码，去除前2个
print(base_uni_list)

# 写出第一次字体文件的编码和对应字体
origin_dict = {'uniE481': '7', 'uniE0AA': '4', 'uniF71E': '9', 'uniE767': '1', 'uniE031': '5', 'uniE4BD': '2',
               'uniF2AA': '3', 'uniE2E3': '6', 'uniE3C9': '8', 'uniEA65': '0'}

# 获取刷新之后在线的字体

# 获取字体文件的base64编码
online_ttf_base64 = re.findall(r"base64,(.*)\) format", response)[0]
online_base64_info = base64.b64decode(online_ttf_base64)
with open('online_font.ttf', 'wb')as f:
    f.write(online_base64_info)
online_font = TTFont('online_font.ttf')  # 网上动态下载的字体文件。

online_uni_list = online_font.getGlyphOrder()[2:]

for uni2 in online_uni_list:
    obj2 = online_font['glyf'][uni2]  # 获取编码uni2在online_font.ttf中对应的对象
    for uni1 in base_uni_list:
        obj1 = base_font['glyf'][uni1]  # 获取编码uni1在base_font.ttf 中对应的对象
        if obj1 == obj2:  # 判断两个对象是否相等
            dd = "&#x" + uni2[3:].lower() + ';'  # 修改为Unicode编码格式
            print(dd)
            if dd in response:  # 如果编码uni2的Unicode编码格式 在response中，替换成origin_dict中的数字。
                response = response.replace(dd, origin_dict[uni1])
                # print(response)

response_info = Selector(text=response)
all_info = response_info.xpath('//ul[@class="canTouch"]')  # 获取所有的信息
print('电影名字' + '\t' + '实时票房(万元)' + '\t' + '票房占比' + '\t' + '排片占比' + '\t' + '上座率')
for each_info in all_info:
    movie_name = each_info.xpath('li[1]/b/text()').extract_first()  # 电影名字
    ticket_number = each_info.xpath('li[2]/b/i[@class="cs"]/text()').extract_first()  # 实时票房(万元)
    ticket_rate = each_info.xpath('li[3]/i[@class="cs"]/text()').extract_first()  # 票房占比
    film_rate = each_info.xpath('li[4]/i[@class="cs"]/text()').extract_first()  # 排片占比
    upper_seat_rate = each_info.xpath('li[5]/span/i[@class="cs"]/text()').extract_first()  # 上座率
    print(movie_name + '\t' + ticket_number + '\t' + ticket_rate + '\t' + film_rate + '\t' + upper_seat_rate)
